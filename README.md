# FlyWeight: Passenger weights, in the cloud

FlyWeight is a website where pilots can list flights they intend to take, and
where passengers can discreetly add their weights to those flights. Weights are
only shared with the pilot, not with other passengers, and are no longer
accessible some time after the flight is complete.

This website allows pilots to perform an accurate weight and balance while
giving passengers a basic assurance of privacy.

## Development

### Installation and Running

FlyWeight requires Ruby 3.0, PostgreSQL, and Redis. (If you use Homebrew,
you can install those dependencies with `brew install`.) After cloning the
repository, run `bundle install` to install all gem requirements. Run
`rails db:create db:migrate` to create the development database.

Run the development server with `Procfile`. (You must have the `foreman` gem
installed). Note that running `rails server` alone will result in front-end bugs
for some reason; running the Procfile (which spins up separate Rails and Webpack
dev server processes) is bug-free.

Turbo requires Active Job workers to be running, as well as the WebSockets
server. The `Procfile` handles this for the development server.

#### Documentation

Comprehensive API documentation can be generated by running `rake yard`. HTML
docs are generated into the `doc/` directory.

#### Testing

Unit tests can be run with `rspec spec`. Unit tests and request tests are
provided. The front-end is not tested.

#### Deployment

The application is deployed using Heroku. Commits to the master branch will
automatically trigger Travis (the continuous integration system). After all
tests pass on Travis, the deploy to Heroku will begin automatically.

## Architecture

FlyWeight is a Ruby on Rails application developed using HTML-over-the-wire
methodology. Turbo is used for XHR response generation and WebSockets streaming,
and Stimulus is used to create lightweight view controllers. FlyWeight should
gracefully degrade without JavaScript.

Only basic assurances of privacy are provided. Flights are only ever referenced
by a generated UUID, to prevent URL-crafting attacks. Pilots can only access
flights whose planned dates are at most one week old.

### Data Model

The account model on FlyWeight is called {Pilot}. Only Pilots are required to
have accounts; passengers can add their weights without logging in. {Pilot}s
create {Flight} records for each of their flights; then they or their passengers
can add {Passenger} records to those flights.

### Authorization

Authentication is handled by Devise. The {Pilot} class is the user model for
Devise, and users are authenticated by their email and password.

Some routes will operate differently depending on whether a pilot is logged in
or not. For example the `/flights/:id` route will display a summary of the
passengers and their weights for authenticated sessions, but will display only a
create-passenger form for unauthenticated sessions. Therefore, the URL that the
pilot uses to view their flight, and the URL they provide to their passengers,
are the same.

(This means currently that pilots cannot view flights belonging to other pilots;
they will have to open an Incognito window first.)

### Controllers

Controllers serve exclusively HTML-over-the-wire but are still organized in a
RESTful, resource-oriented manner.

FlyWeight combines the login and signup pages into the root URL, dispatched to
{HomeController#index}. All unauthorized requests are redirected to the root
URL. The root URL for authorized users is `/flights`
({FlightsController#index}).

### Views

All view assets are compiled using Webpack via Webpacker. CSS is written in
SCSS. The primary font, Archivo, is a variable-width font in normal and oblique
styles.

All strings are stored in Rails i18n YAML files.

JavaScript files are linted using ESLint, and CSS files are linted using
Stylelint. Both can be run using `yarn lint`
